yend = Factor2 * alpha * 0.95),
data = sp_res,
size = .1) +
geom_point(aes(x = Factor1, y = Factor2,
color = vars(cont_pred1),
size = ht),
data = site_res)+
scale_color_gradientn(colours = brewer.pal(n = 10, name = "RdYlBu"))
}
plot_factors1(alpha, "pa", "mod1", sp_res, site_res, cont_pred1 = "be10", cont_pred2 = "ht")
plot_factors1 <- function(alpha, abund, model, spData, siteData,
cont_pred1 = elevation_m, cont_pred2 = lg_YrsDisturb, cat_pred = insideHJA) {
cont_pred1 <- ensym(cont_pred1)
ggplot() +
geom_segment(aes(x = 0, y = 0,
xend = Factor1 * alpha * 0.95,
yend = Factor2 * alpha * 0.95),
data = sp_res,
size = .1) +
geom_point(aes(x = Factor1, y = Factor2,
color = !!cont_pred1,
size = ht),
data = site_res)+
scale_color_gradientn(colours = brewer.pal(n = 10, name = "RdYlBu"))
}
plot_factors1(alpha, "pa", "mod1", sp_res, site_res, cont_pred1 = "be10", cont_pred2 = "ht")
plot_factors1(alpha, "pa", "mod1", sp_res, site_res, cont_pred1 = be10, cont_pred2 = "ht")
plot_factors <- function(alphanum, abund, model, spData, siteData,
cont_pred1 = elevation_m, cont_pred2 = lg_YrsDisturb, cat_pred = insideHJA) {
alpha <- alphanum
cont_pred1 <- ensym(cont_pred1)
cont_pred2 <- ensym(cont_pred2)
cat_pred1 <- ensym(cat_pred1)
ggplot() +
geom_segment(aes(x = 0, y = 0,
xend = Factor1 * alpha * 0.95,
yend = Factor2 * alpha * 0.95),
data = spData,
size = .1) +
geom_point(aes(x = Factor1, y = Factor2,
color = !!cont_pred1,
size = !!cont_pred2),
#,shape = as.factor(vars(cat_pred))
data = siteData) +
# geom_text_repel(aes(x = Factor1, y = Factor2,
#                     label = env.csv$SiteName),
#                 data = siteData,
#                 size = 2) +
# geom_label_repel(aes(x = Factor1 * alpha, y = Factor2 * alpha, label = species), data = sp_res, size = 2.5) +
scale_color_gradientn(colours = brewer.pal(n = 10, name = "RdYlBu")) +
theme_classic() + # or "PuOr" or "RdYlBu"
labs(title = glue("HJA, ecoCopula ordination, {abund}"),
subtitle = model) +
xlab("Factor 1") +
ylab("Factor 2")
}
plot_factors(alpha, "pa", "mod1", sp_res, site_res, cont_pred1 = "be10", cont_pred2 = "ht")
source("Hmsc_CD/local/fn_ecoCopula_plot.r")## modified plot functions...
plot_factors(alpha, "pa", "mod1", sp_res, site_res, cont_pred1 = "be10", cont_pred2 = "ht")
source("Hmsc_CD/local/fn_ecoCopula_plot.r")## modified plot functions...
plot_xy_factor1("pa", "mod1", site_res)
plot_xy_factor1("pa", "mod1", site_res, cont_pred2 = ht)
plot_xy_factor2("pa", "mod1", site_res, cont_pred2 = ht)
plot_xy_factor1("pa", "mod1", site_res, cont_pred2 = ht)
mod <- modList[[2]]$mod
site_res <- modList[[2]]$site
mod <- modList[[2]]$mod
sp_res <- modList[[2]]$sp
site_res <- modList[[2]]$site
alpha <- 4*0.95
ggplot() +
geom_segment(aes(x = 0, y = 0,
xend = Factor1 * alpha * 0.95,
yend = Factor2 * alpha * 0.95),
data = sp_res,
size = .1) +
geom_point(aes(x = Factor1, y = Factor2,
color = be10,
size = ht),
data = site_res)+
scale_color_gradientn(colours = brewer.pal(n = 10, name = "RdYlBu"))
plot_factors(alpha, "pa", "mod1", sp_res, site_res, cont_pred1 = "be10", cont_pred2 = "ht")
plot_xy_factor1("pa", "mod1", site_res, cont_pred2 = ht)
plot_xy_factor2("pa", "mod1", site_res, cont_pred2 = ht)
plot_xy_factor1("pa", "mod1", site_res, cont_pred2 = ht)
cor.preds <- colnames(env.vars)[sapply(env.vars, is.numeric)]
mod.cor <- cor(mod.ord$scores, site_res[,cor.preds])
mod.ord <- modList[[2]]$ord
mod.cor <- cor(mod.ord$scores, site_res[,cor.preds])
t_corrplot(mod.cor, "mod1")
alpha <- 4*0.95
for(i in seq_along(modList)){
mod <- modList[[i]]$mod
mod.ord <- modList[[i]]$ord
sp_res <- modList[[i]]$sp
site_res <- modList[[i]]$site
# chk residuals
# plot(mod)
modName <- paste0("predictors: ", as.character(fm[[i]])[3])
#plot factors
p1 <- plot_factors(alpha, "pa", "", sp_res, site_res)
## correlation plot
mod.cor <- cor(mod.ord$scores, site_res[,cor.preds])
p2 <- ~t_corrplot(mod.cor, "")
# Plot over coords with factors as colour fill
p3 <- plot_xy_factor1("pa", "", site_res)
p4 <- plot_xy_factor2("pa", "", site_res)
# put rows together
pA <- plot_grid(p2, p1, rel_widths = c(4,5), align = "h", axis = "t")
pB <- plot_grid(p3, p4) # p4
title <- ggdraw() +
draw_label(modName, fontface = 'bold', size = 15, x = 0.0, y = 0.5, hjust = 0)
m1 <- plot_grid(pA, pB, title, nrow = 3, rel_heights = c(4,5,1))
# m1 <- plot_grid(pA, pB, nrow = 2, rel_heights = c(4,5))
# m1
ggsave(paste0("Hmsc_CD/local/plots/mod_topo", i, ".png"), m1, width = 300, height = 250, units = "mm")
}
for(i in seq_along(modList)){
mod <- modList[[i]]$mod
mod.ord <- modList[[i]]$ord
sp_res <- modList[[i]]$sp
site_res <- modList[[i]]$site
# chk residuals
# plot(mod)
modName <- paste0("predictors: ", as.character(fm[[i]])[3])
#plot factors
p1 <- plot_factors(alpha, "pa", "", sp_res, site_res, cont_pred1 = "be10", cont_pred2 = "ht")
## correlation plot
mod.cor <- cor(mod.ord$scores, site_res[,cor.preds])
p2 <- ~t_corrplot(mod.cor, "")
# Plot over coords with factors as colour fill
p3 <- plot_xy_factor1("pa", "", site_res, cont_pred2 = ht)
p4 <- plot_xy_factor2("pa", "", site_res, cont_pred2 = ht)
# put rows together
pA <- plot_grid(p2, p1, rel_widths = c(4,5), align = "h", axis = "t")
pB <- plot_grid(p3, p4) # p4
title <- ggdraw() +
draw_label(modName, fontface = 'bold', size = 15, x = 0.0, y = 0.5, hjust = 0)
m1 <- plot_grid(pA, pB, title, nrow = 3, rel_heights = c(4,5,1))
# m1 <- plot_grid(pA, pB, nrow = 2, rel_heights = c(4,5))
# m1
ggsave(paste0("Hmsc_CD/local/plots/mod_topo", i, ".png"), m1, width = 300, height = 250, units = "mm")
}
fm <- list(as.formula(otu.pa ~ be10 + Nss + Ess + ht + cov2_4 +  cov4_16 + mTopo + ht.r1k + cov2_4.r1k + cov4_16.r1k)
#,as.formula(otu.pa ~ be10 + slope + Nss + Ess + twi + ht.r1k + cov2_4.r1k + cov4_16.r1k + mTopo)
)
fm
dataN <- c(list(otu.pa = mvabund(otu.pa.csv)), as.list(topo.df))
str(dataN)
source("Hmsc_CD/local/L1_read_data.r")
# otu.pa.csv is Y.train.pa; otu.qp.csv is Y.train.qp
rm(Y.train.qp, Y.train.pa, X.train)
# load new topo vars
load("Hmsc_CD/oregon_ada/data/topo_data.rdata")
# remove NA
sum(is.na(topo.df))
ind <- which(is.na(topo.df$twi))
topo.df <- topo.df[-ind,]
# same with otu
otu.pa.csv <- otu.pa.csv[-ind,]
# same with S.train
S.train <- S.train[-ind,]
## Make list of formulae to loop through,
colnames(topo.df)
dataN <- c(list(otu.pa = mvabund(otu.pa.csv)), as.list(topo.df))
str(dataN)
unique(unlist(sapply(fm, all.vars)))
all(unique(unlist(sapply(fm, all.vars))) %in% names(dataN))
nCores <- 2
cl <- makeCluster(nCores)
registerDoParallel(cl)
fm <- list(as.formula(otu.pa ~ be10 + Nss + Ess + ht + cov2_4 +  cov4_16 + mTopo + ht.r1k + cov2_4.r1k + cov4_16.r1k)
,as.formula(otu.pa ~ be10 + slope + ht.r1k + cov2_4.r1k + cov4_16.r1k + mTopo + cut.r1k.pt)
)
fm
modList <- foreach(i = seq_along(fm),
.combine = list,
.multicombine = TRUE, # ,.export = c("otu.pa", "env.vars", "S.train")
.noexport = c("otu.pa.csv","otu.qp.csv", "P")
) %dopar% {
# do glm model
mod <- mvabund::manyglm(fm[[i]], family = "negative.binomial", data = dataN)
# do ordination
mod.ord <- ecoCopula::cord(mod)
# Site scores: join ordination axes to data frame of predictors, coordinates
site_res <- data.frame(mod.ord$scores, topo.df, S.train[,c("UTM_E", "UTM_N")])
# Species scores
sp_res <- data.frame(mod.ord$loadings, species = colnames(dataN$otu.pa))
# don't do this locally
# do anova
# summ <- mvabund::summary.manyglm(mod, nBoot = nBoot, test = "LR")
# summ
# list(mod = mod, ord = mod.ord, site = site_res, sp=sp_res, summ = summ)
list(mod = mod, ord = mod.ord, site = site_res, sp=sp_res)
}
stopCluster(cl)
for(i in seq_along(modList)){
mod <- modList[[i]]$mod
mod.ord <- modList[[i]]$ord
sp_res <- modList[[i]]$sp
site_res <- modList[[i]]$site
# chk residuals
# plot(mod)
modName <- paste0("predictors: ", as.character(fm[[i]])[3])
#plot factors
p1 <- plot_factors(alpha, "pa", "", sp_res, site_res, cont_pred1 = "be10", cont_pred2 = "ht")
## correlation plot
mod.cor <- cor(mod.ord$scores, site_res[,cor.preds])
p2 <- ~t_corrplot(mod.cor, "")
# Plot over coords with factors as colour fill
p3 <- plot_xy_factor1("pa", "", site_res, cont_pred2 = ht)
p4 <- plot_xy_factor2("pa", "", site_res, cont_pred2 = ht)
# put rows together
pA <- plot_grid(p2, p1, rel_widths = c(4,5), align = "h", axis = "t")
pB <- plot_grid(p3, p4) # p4
title <- ggdraw() +
draw_label(modName, fontface = 'bold', size = 15, x = 0.0, y = 0.5, hjust = 0)
m1 <- plot_grid(pA, pB, title, nrow = 3, rel_heights = c(4,5,1))
# m1 <- plot_grid(pA, pB, nrow = 2, rel_heights = c(4,5))
# m1
ggsave(paste0("Hmsc_CD/local/plots/mod_topo", i, ".png"), m1, width = 300, height = 250, units = "mm")
}
getwd()
wd <- here::here()
setwd(wd)
dir()
rm(wd)
library(sf)
library(raster)
source("Hmsc_CD/local/L1_read_data.r")
rm(Y.train.pa, Y.train.qp, P, otu.pa.csv, otu.qp.csv, X.train)
head(S.train)
xy.sf <- st_as_sf(S.train, coords = c("UTM_E", "UTM_N"), crs = nadutm10)
nadutm10 <- 26910
utm10N <- 32610
xy.sf <- st_as_sf(S.train, coords = c("UTM_E", "UTM_N"), crs = nadutm10)
rm(S.train)
# transform to wgs utm to match rasters
xy.utm <- st_transform(xy.sf, crs = utm10N)
rm(xy.sf)
# write
gis <- "J:/UEA/Oregon/gis"
load(file.path(gis, "r_utm/cut_stack.rdata"))
load(file.path(gis, "r_utm/elev_cov.rdata"))
cut.r1k.pt <- extract(cutStack$cut_r1k, xy.utm)
dem500 <- raster::extract(terr$be10, xy.utm, buffer = 500, fun=mean, na.rm = T)
dem.pt <- raster::extract(terr$be10, xy.utm)
mTopo <- dem.pt - dem500
terr.pt <- raster::extract(terr, xy.utm)
cov.pt <- raster::extract(covStack, xy.utm)
topo.df <- data.frame(uniqueID = xy.utm$uniqueID, terr.pt, cov.pt, mTopo, cut.r1k.pt)
head(topo.df)
str(topo.df)
summary(topo.df)
save(topo.df, file = "Hmsc_CD/oregon_ada/data/topo_data.rdata")
topo.df <- data.frame(uniqueID = xy.utm$uniqueID, terr.pt, cov.pt, be500 = dem500, mTopo, cut.r1k.pt)
head(topo.df)
str(topo.df)
summary(topo.df)
save(topo.df, file = "Hmsc_CD/oregon_ada/data/topo_data.rdata")
getwd()
library(Hmsc)
wd <- here::here()
wd
setwd(wd)
source("Hmsc_CD/local/fn_getAUC.r")
resF <- list.files("Hmsc_CD/oregon_ada/results", pattern = "res\\d*_\\d{2}$", include.dirs = TRUE, full.names = T)
resF
rF <- resF[!resF %in% c("Hmsc_CD/oregon_ada/results/res20210107_01",
"Hmsc_CD/oregon_ada/results/res20201217_01",
"Hmsc_CD/oregon_ada/results/res20201127_01",
"Hmsc_CD/oregon_ada/results/res20201204_01", # qp
"Hmsc_CD/oregon_ada/results/res20201209_01", # qp
"Hmsc_CD/oregon_ada/results/res20201216_02" # error
)]
modRes <- lapply(rF, getAUC, rMod = TRUE)
all.df <- do.call(rbind, modRes)
head(all.df)
rm(modRes, resF, rF)
all.df <- all.df[order(all.df$AUC_pred, decreasing = TRUE),]
head(all.df)
load("Hmsc_CD/oregon_ada/results/ecocopula/ecocopula_modlist_pilot.rdata")
str(modList, max.level =2)
fm <- list(as.formula(otu.pa ~  be500 + tri + insideHJA + lg_YrsDisturb),
as.formula(otu.pa ~ be500 * oldGrowthIndex + tri + insideHJA + lg_YrsDisturb),
as.formula(otu.pa ~ be500 * insideHJA + tri + oldGrowthIndex + lg_YrsDisturb),
as.formula(otu.pa ~ be500 + tri + insideHJA + oldGrowthIndex + lg_YrsDisturb + mean.NDVI + lg_DistRoad + canopyHeight_m),
as.formula(otu.pa ~ be500 * insideHJA + be500 * oldGrowthIndex + tri + lg_YrsDisturb + mean.NDVI + lg_DistRoad),
as.formula(otu.pa ~ be10 + Nss + Ess + ht + cov2_4 + cov4_16 + ht.r1k + cov2_4.r1k + cov4_16.r1k + mTopo),
as.formula(otu.pa ~ be10 + Nss + Ess + ht + cov2_4 + cov4_16 + ht.r500 + cov2_4.r500 + cov4_16.r500 + mTopo),
as.formula(otu.pa ~ be10 + Nss + Ess + ht + cov2_4 + cov4_16 + ht.r250 + cov2_4.r250 + cov4_16.r250 + mTopo),
as.formula(otu.pa ~ be500 + slope + twi + ht + cov2_4 + cov4_16 + ht.r500 + cov2_4.r500 + cov4_16.r500 + mTopo)
)
fm
an <- modList[[6]]$summ
an
lapply(modList, function(x) x$summ)
mods <- lapply(modList, function(x) x$mod)
mods
anov <- mvabund::anova.manyglm(mods, nBoot =1, test = "LR")
anov <- mvabund::anova.manyglm(mods, nBoot = 5, test = "LR")
mods$nBoot <- 5
mods$test <- "LR"
anov <- do.call(mvabund::anova.manyglm, mods)
str(mods, max.level = 1)
anov <- mvabund::anova.manyglm(mods[[1]], mods[[2]], nBoot = 5, test = "LR")
anov
anov <- mvabund::anova.manyglm(mods[[2]], mods[[4]], mods[[6]], mods[[7]], mods[[8]], mods[[9]], nBoot = 100, test = "LR")
mods[[9]]
anov <- mvabund::anova.manyglm(mods[[4]], mods[[6]], mods[[7]], mods[[8]], mods[[9]], nBoot = 100, test = "LR")
anov <- mvabund::anova.manyglm(mods[[6]], mods[[7]], mods[[8]], mods[[9]], nBoot = 100, test = "LR")
anov <- mvabund::anova.manyglm(mods[[7]], mods[[8]], mods[[9]], nBoot = 100, test = "LR")
mods[[8]]
anov <- mvabund::anova.manyglm(mods[[8]], mods[[9]], nBoot = 100, test = "LR")
anov <- mvabund::anova.manyglm(mods[[9]], nBoot = 100, test = "LR")
anov <- mvabund::anova.manyglm(mods[[9]], mods[[6]], nBoot = 100, test = "LR")
anov <- mvabund::anova.manyglm(mods[[8]], mods[[6]], nBoot = 100, test = "LR")
anov <- mvabund::anova.manyglm(mods[[8]], mods[[7]], nBoot = 100, test = "LR")
anov <- mvabund::anova.manyglm(mods[8], mods[7], nBoot = 100, test = "LR")
anov <- mvabund::anova.manyglm(mods[[7]], mods[[6]], nBoot = 100, test = "LR")
anov <- mvabund::anova.manyglm(mods[[5]], mods[[6]], nBoot = 100, test = "LR")
anov <- mvabund::anova.manyglm(mods[[5]], mods[[4]], nBoot = 100, test = "LR")
anov <- mvabund::anova.manyglm(mods[[2]], mods[[3]], nBoot = 100, test = "LR")
anov <- mvabund::anova.manyglm(modList[[2]]$mod, modList[[3]]$mod, nBoot = 100, test = "LR")
anov <- mvabund::anova.manyglm(modList[[1]]$mod, modList[[2]]$mod, nBoot = 100, test = "LR")
anov
lapply(modList, function(x) x$summ)
fm <- list(as.formula(otu.pa~be10+B11_median+mean.EVI+insideHJA + Ess + ht + ht.r500 + cov2_4 + cov2_4.r500 + mTopo),
as.formula(otu.pa~be10+B11_median+mean.EVI+insideHJA + Ess + ht + ht.r500 + cov4_16 + cov4_16.r500 + mTopo),
as.formula(otu.pa~be10+B11_median + mean.EVI + insideHJA + Ess + ht + ht.r1k + cov2_4 + cov2_4.r1k + mTopo),
as.formula(otu.pa~be10+B11_median+mean.EVI+insideHJA + Ess + ht + ht.r1k + cov4_16 + cov4_16.r1k + mTopo),
as.formula(otu.pa~be500+slope+cov2_4+ht.r500+cov2_4.r500+cov4_16.r500+mTopo+mean.EVI+B11_median+insideHJA)
)
lengths(fm)
length(as.formula(otu.pa~be10+B11_median+mean.EVI+insideHJA + Ess + ht + ht.r500 + cov2_4 + cov2_4.r500 + mTopo)
)
unlist(sapply(fm, all.vars))
lapply(fm, all.vars)
lengths(lapply(fm, all.vars))
lengths(lapply(fm, all.vars))-1
fm <- list(as.formula(otu.pa~be10+B11_median+mean.EVI+insideHJA + Ess + ht + ht.r500 + cov2_4 + cov2_4.r500 + mTopo),
as.formula(otu.pa~be10+B11_median+mean.EVI+insideHJA + Ess + ht + ht.r500 + cov4_16 + cov4_16.r500 + mTopo),
as.formula(otu.pa~be10+B11_median + mean.EVI + insideHJA + Ess + ht + ht.r1k + cov2_4 + cov2_4.r1k + mTopo),
as.formula(otu.pa~be10+B11_median+mean.EVI+insideHJA + Ess + ht + ht.r1k + cov4_16 + cov4_16.r1k + mTopo),
as.formula(otu.pa~be500+slope+cov2_4+ht.r500+cov2_4.r500+cov4_16.r500+mTopo+mean.EVI+B11_median+insideHJA),
as.formula(otu.pa~be500+Ess+cov2_4+ht.r500+cov2_4.r500+be10+cov4_16.r500+mTopo+mean.EVI+B11_median+insideHJA),
#mod8 (and 7) v2 - all significant + VIs
as.formula(otu.pa~be10+Ess+cov2_4+mTopo+mean.EVI+B11_median+insideHJA),
)
fm
lengths(lapply(fm, all.vars))-1
lapply(fm, all.vars)
fm <- list(as.formula(otu.pa~be10+B11_median+mean.EVI+insideHJA + Ess + ht + ht.r500 + cov2_4 + cov2_4.r500 + mTopo),
as.formula(otu.pa~be10+B11_median+mean.EVI+insideHJA + Ess + ht + ht.r500 + cov4_16 + cov4_16.r500 + mTopo),
as.formula(otu.pa~be10+B11_median + mean.EVI + insideHJA + Ess + ht + ht.r1k + cov2_4 + cov2_4.r1k + mTopo),
as.formula(otu.pa~be10+B11_median+mean.EVI+insideHJA + Ess + ht + ht.r1k + cov4_16 + cov4_16.r1k + mTopo),
as.formula(otu.pa~be500+slope+cov2_4+ht.r500+cov2_4.r500+cov4_16.r500+mTopo+mean.EVI+B11_median+insideHJA),
as.formula(otu.pa~be500+Ess+cov2_4+ht.r500+cov2_4.r500+be10+cov4_16.r500+mTopo+mean.EVI+B11_median+insideHJA),
#mod8 (and 7) v2 - all significant + VIs
as.formula(otu.pa~be10+Ess+cov2_4+mTopo+mean.EVI+B11_median+insideHJA)
)
lengths(lapply(fm, all.vars))-1
source("code/S1_read_data.r")
wd <- here::here()
setwd(file.path(wd, "Hmsc_CD/oregon_ada"))
source("code/S1_read_data.r")
rm(Y.train.qp, Y.train.pa, X.train)
colnames(env.vars)
fm <- list(as.formula(otu.pa~be10+B11_median+mean.EVI+insideHJA + Ess + ht + ht.r500 + cov2_4 + cov2_4.r500 + mTopo),
as.formula(otu.pa~be10+B11_median+mean.EVI+insideHJA + Ess + ht + ht.r500 + cov4_16 + cov4_16.r500 + mTopo),
as.formula(otu.pa~be10+B11_median + mean.EVI + insideHJA + Ess + ht + ht.r1k + cov2_4 + cov2_4.r1k + mTopo),
as.formula(otu.pa~be10+B11_median+mean.EVI+insideHJA + Ess + ht + ht.r1k + cov4_16 + cov4_16.r1k + mTopo),
as.formula(otu.pa~be500+slope+cov2_4+ht.r500+cov2_4.r500+cov4_16.r500+mTopo+mean.EVI+B11_median+insideHJA),
as.formula(otu.pa~be500+Ess+cov2_4+ht.r500+cov2_4.r500+be10+cov4_16.r500+mTopo+mean.EVI+B11_median+insideHJA),
#mod8 (and 7) v2 - all significant + VIs
as.formula(otu.pa~be10+be500+Ess+cov2_4+mTopo+mean.EVI+B11_median+insideHJA)
)
fm
# No of predictors per formula
lengths(lapply(fm, all.vars))-1
dataN <- c(list(otu.pa = mvabund(otu.pa.csv)), as.list(env.vars))
library(mvabund)
library(ecoCopula)
dataN <- c(list(otu.pa = mvabund(otu.pa.csv)), as.list(env.vars))
# str(dataN)
# check all terms are in data object
unique(unlist(sapply(fm, all.vars)))
all(unique(unlist(sapply(fm, all.vars))) %in% names(dataN))
length(fm)
preds <- c("be10", "Nss", "Ess", "ht", "cov2_4", "cov4_16", "ht.r1k", "cov2_4.r1k", "cov4_16.r1k", "mTopo") # , "cut.r1k.pt"
XFormula <- as.formula(paste0("~ ", paste0(preds, collapse = " + ")))
XFormula
Xformula1 <- as.formula(~be10+B11_median+mean.EVI+insideHJA + Ess + ht + ht.r500 + cov4_16 + cov4_16.r500 + mTopo)
Xformula2 <- as.formula(~be10+B11_median+mean.EVI+insideHJA + Ess + ht + ht.r1k + cov2_4 + cov2_4.r1k + mTopo)
Xformula3 <- as.formula(~be10+B11_median+mean.EVI+insideHJA + Ess + ht + ht.r1k + cov4_16 + cov4_16.r1k + mTopo)
Xformula4 <- as.formula(~be500+slope+cov2_4+ht.r500+cov2_4.r500+cov4_16.r500+mTopo+mean.EVI+B11_median+insideHJA)
head(S.train)
length(unique(S.train$SiteName))
length(unique(S.train$uniqueID))
studyDesign <- data.frame(
site = as.factor(S.train$SiteName),
unique_sample = as.factor(S.train$uniqueID)
)
xy <- data.frame(S.train[match(unique(S.train$SiteName), S.train$SiteName), c("UTM_E", "UTM_N")])
# check for duplicated coordiantes>
sum(duplicated(xy))
rownames(xy) <- unique(S.train$SiteName)
rL.site <- HmscRandomLevel(sData = xy)
## Make models
models <- list(
m1 = Hmsc(Y = Y.train.pa2, # reduced species set
XData = X.train, XFormula = XFormula1,
phyloTree = P,
distr = "probit"),
m2 = Hmsc(Y = Y.train.pa2,
XData = X.train, XFormula = XFormula2,
phyloTree = P,
distr = "probit"),
m3 = Hmsc(Y = Y.train.pa2,
XData = X.train, XFormula = XFormula3,
phyloTree = P,
distr = "probit"),
m4 = Hmsc(Y = Y.train.pa2,
XData = X.train, XFormula = XFormula4,
phyloTree = P,
distr = "probit")
)
library(Hmsc)
models <- list(
m1 = Hmsc(Y = Y.train.pa2, # reduced species set
XData = X.train, XFormula = XFormula1,
phyloTree = P,
distr = "probit"),
m2 = Hmsc(Y = Y.train.pa2,
XData = X.train, XFormula = XFormula2,
phyloTree = P,
distr = "probit"),
m3 = Hmsc(Y = Y.train.pa2,
XData = X.train, XFormula = XFormula3,
phyloTree = P,
distr = "probit"),
m4 = Hmsc(Y = Y.train.pa2,
XData = X.train, XFormula = XFormula4,
phyloTree = P,
distr = "probit")
)
range(colMeans(Y.train.pa > 0))
min(colSums(Y.train.pa > 0))
getwd()
source('J:/UEA/gitHRepos/HJA_analyses_Kelpie/Hmsc_CD/oregon_ada/code/S1_read_data.r', echo=TRUE)
source('J:/UEA/gitHRepos/HJA_analyses_Kelpie/Hmsc_CD/oregon_ada/code/S2_define_models.r', echo=TRUE)
all.vars(XFormula1)
XFormula1 <- as.formula(~be10+B11_median+mean.EVI+insideHJA + Ess + ht + ht.r500 + cov4_16 + cov4_16.r500 + mTopo)
XFormula2 <- as.formula(~be10+B11_median+mean.EVI+insideHJA + Ess + ht + ht.r1k + cov2_4 + cov2_4.r1k + mTopo)
XFormula3 <- as.formula(~be10+B11_median+mean.EVI+insideHJA + Ess + ht + ht.r1k + cov4_16 + cov4_16.r1k + mTopo)
XFormula4 <- as.formula(~be500+slope+cov2_4+ht.r500+cov2_4.r500+cov4_16.r500+mTopo+mean.EVI+B11_median+insideHJA)
all.vars(XFormula1)
all.vars(XFormula1) %in% names(X.train)
all(all.vars(XFormula1) %in% names(X.train))
all(all.vars(XFormula2) %in% names(X.train))
all(all.vars(XFormula3) %in% names(X.train))
all(all.vars(XFormula4) %in% names(X.train))
# S$site_trap_period is a unique sample code in the StudyDesign matrix, but is currently not included in the models.
head(S.train)
length(unique(S.train$SiteName))
length(unique(S.train$uniqueID))
studyDesign <- data.frame(
site = as.factor(S.train$SiteName),
unique_sample = as.factor(S.train$uniqueID)
)
xy <- data.frame(S.train[match(unique(S.train$SiteName), S.train$SiteName), c("UTM_E", "UTM_N")])
# check for duplicated coordiantes>
sum(duplicated(xy))
rownames(xy) <- unique(S.train$SiteName)
# head(xy); tail(xy)
rL.site <- HmscRandomLevel(sData = xy)
## Make models
models <- list(
m1 = Hmsc(Y = Y.train.pa2, # reduced species set
XData = X.train, XFormula = XFormula1,
phyloTree = P,
distr = "probit"),
m2 = Hmsc(Y = Y.train.pa2,
XData = X.train, XFormula = XFormula2,
phyloTree = P,
distr = "probit"),
m3 = Hmsc(Y = Y.train.pa2,
XData = X.train, XFormula = XFormula3,
phyloTree = P,
distr = "probit"),
m4 = Hmsc(Y = Y.train.pa2,
XData = X.train, XFormula = XFormula4,
phyloTree = P,
distr = "probit")
)
models
names(models) <- c("pa_nsp_nTopo_v3m2", "pa_nsp_nTopo_v3m3", "pa_nsp_nTopo_v3m4", "pa_nsp_nTopo_v3m5")
modelnames <-  c("pa_nsp_nTopo_v3m2", "pa_nsp_nTopo_v3m3", "pa_nsp_nTopo_v3m4", "pa_nsp_nTopo_v3m5")
models
rm(S.train, X.train, P, XFormula, rL.site, studyDesign, preds, preds2, XFormula2)
rm(S.train, X.train, P, XFormula, rL.site, studyDesign, XFormula1, XFormula2,XFormula3, XFormula4)
source('J:/UEA/gitHRepos/HJA_analyses_Kelpie/Hmsc_CD/oregon_ada/code/S1_read_data.r', echo=TRUE)
source('J:/UEA/gitHRepos/HJA_analyses_Kelpie/Hmsc_CD/oregon_ada/code/S2_define_models.r', echo=TRUE)
models
source('J:/UEA/gitHRepos/HJA_analyses_Kelpie/Hmsc_CD/oregon_ada/code/S1_read_data.r', echo=TRUE)
setwd("J:/UEA/gitHRepos/HJA_analyses_Kelpie/Hmsc_CD/oregon_ada")
source('J:/UEA/gitHRepos/HJA_analyses_Kelpie/Hmsc_CD/oregon_ada/code/S1_read_data.r', echo=TRUE)
source('J:/UEA/gitHRepos/HJA_analyses_Kelpie/Hmsc_CD/oregon_ada/code/S2_define_models.r', echo=TRUE)
models
samples_list = c(5,50)
thin_list = c(1,5)
(samples_list * thin_list) + ceiling(0.5*thin_list*samples_list)
